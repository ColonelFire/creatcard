<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Générateur de cartes TCG — bord unique blanc</title>
  <style>
    :root{
      /* Dimensions réelles pour l'impression */
      --card-w: 63mm;
      --card-h: 89mm;
      --frame-w: 2.5mm;
      --comp-w: 10mm;
      --comp-h: 7mm;
      --comp-notch: 3mm; /* angle coupé */
      --blue-h: 30mm;
      --left-pad: 6mm;

      /* Bord unique blanc */
      --frame-color: #ffffff;
      --corner-border: #ffffff;

      /* Couleurs bande par défaut (Commun) */
      --accent-hex:#93BF34;
      --accent-alpha:1;

      --text-dark:#0D0D0D;
      --paper:#f3f6f9;
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      background:#114BBF; /* fond demandé */
      color:#e6e8eb;
    }

    .app{display:grid;grid-template-columns:360px 1fr;gap:24px;padding:20px;max-width:1400px;margin:0 auto}
    .panel{background:#13161b;border:1px solid #222831;border-radius:14px;padding:16px;position:sticky;top:12px;height:fit-content;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .panel h2{margin:0 0 12px;font-size:18px;font-weight:700}
    .group{margin:14px 0}
    label{display:block;font-size:12px;color:#a9b2bd;margin-bottom:6px}
    select,input[type="text"],input[type="number"],textarea{width:100%;background:#0f1216;border:1px solid #2a3038;color:#dfe3e8;border-radius:10px;padding:10px 12px;outline:none}
    textarea{min-height:90px;resize:vertical}
    input[type="file"]{width:100%}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid #2a3038;background:#0f1216;color:#e7ebf0;cursor:pointer}

    /* PRÉVISU */
    .stage{display:grid;place-items:start center;padding:10px}
    .zoom-wrap{transform:scale(1.8);transform-origin:top center}

    .card{
      width:var(--card-w); height:var(--card-h);
      background:var(--paper);
      border:var(--frame-w) solid var(--frame-color); /* bord unique blanc */
      border-radius:0; /* carré */
      box-shadow:0 12px 40px rgba(0,0,0,.6);
      position:relative; box-sizing:border-box; overflow:hidden; color:var(--text-dark);
      print-color-adjust:exact; -webkit-print-color-adjust:exact; color-adjust:exact;
    }
    .inner{position:absolute;left:var(--frame-w);top:var(--frame-w);width:calc(100% - 2*var(--frame-w));height:calc(100% - 2*var(--frame-w))}

    /* Compartiments toujours visibles au-dessus de l'image */
    .comp{
      position:absolute; top:0; width:var(--comp-w); height:var(--comp-h);
      background:#ffffff; border:.6mm solid var(--corner-border); color:#111;
      display:grid; place-items:center; font-weight:700; letter-spacing:.3px;
      z-index:3;
    }
    .comp span{transform:translateY(-1px);font-size:11px}
    .comp.left{left:0;clip-path:polygon(0 0,100% 0,100% 100%,calc(100% - var(--comp-notch)) 100%,0 calc(100% - var(--comp-notch)));border-top-left-radius:0}
    .comp.right{right:0;clip-path:polygon(0 0,100% 0,100% calc(100% - var(--comp-notch)),100% calc(100% - var(--comp-notch)),0 100%);border-top-right-radius:0}

    /* Illustration derrière tout */
    .art{position:absolute;left:0;right:0;top:0;bottom:var(--blue-h);background:#e9edf1;display:grid;place-items:center;overflow:hidden;z-index:1}
    .art img{width:100%;height:100%;object-fit:cover;display:block}

    /* Bande bas */
    .panel-desc{
      position:absolute;left:0;right:0;bottom:0;height:var(--blue-h);
      background: rgba(147,191,52,1); /* surchargée en JS */
      display:grid;grid-template-rows:auto 1fr auto;gap:3mm;align-content:start;
      padding:3mm 4mm 3mm 0;
      z-index:2;
    }
    .name{font-weight:800;font-size:14px;padding-left:var(--left-pad);line-height:1;padding-top:1mm}
    .desc{font-size:12px;padding-left:var(--left-pad);padding-right:4mm;line-height:1.25;white-space:pre-wrap}
    .baseline{display:grid;grid-template-columns:1fr auto;align-items:end;padding:0 4mm 2mm}
    .illus{font-size:10px;padding-left:var(--left-pad);opacity:.85}
    .num{font-size:10px;opacity:.9}

    /* Full art : image sur toute la carte, bande flottante */
    .fullart .art{top:0;bottom:0}
    .fullart .panel-desc{backdrop-filter:blur(2px)}

    @media print{
      body{background:#fff}
      .app{display:block}
      .panel{display:none}
      .stage{display:block}
      .zoom-wrap{transform:none}
      .card{margin:10mm auto}
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="panel">
      <h2>Paramètres</h2>

      <div class="group">
        <label for="modele">Modèle de carte</label>
        <select id="modele">
          <option value="classique">Classique</option>
          <option value="fullart">Full art</option>
        </select>
      </div>

      <div class="group">
        <label for="rarete">Rareté</label>
        <select id="rarete">
          <option value="Commun">Commun (1)</option>
          <option value="Peu Commune">Peu Commune (2)</option>
          <option value="Rare">Rare (3)</option>
          <option value="Epic">Epic (4)</option>
          <option value="Légendaire">Légendaire (5)</option>
          <option value="Exluusif">Exluusif (6)</option>
        </select>
      </div>

      <div class="group row">
        <div>
          <label for="nom">Nom</label>
          <input id="nom" type="text" placeholder="Nom de la créature"/>
        </div>
        <div>
          <label for="pv">PV</label>
          <input id="pv" type="number" min="0" step="10" placeholder="120"/>
        </div>
      </div>

      <div class="group row">
        <div>
          <label for="extension">Extension</label>
          <input id="extension" type="text" placeholder="CL01"/>
        </div>
        <div>
          <label for="numero">Numéro</label>
          <input id="numero" type="text" placeholder="002/112"/>
        </div>
      </div>

      <div class="group">
        <label for="illustrateur">Illustrateur</label>
        <input id="illustrateur" type="text" placeholder="Nom de l'artiste"/>
      </div>

      <div class="group">
        <label for="desc">Description & Attaque</label>
        <textarea id="desc" placeholder="Description de la créature, effets et/ou attaque…"></textarea>
      </div>

      <div class="group">
        <label for="image">Image (illustration)</label>
        <input id="image" type="file" accept="image/*"/>
      </div>

      <div class="group row">
        <button class="btn" id="reset">Réinitialiser</button>
        <button class="btn" id="exportPNG">Exporter en PNG</button>
      </div>
    </aside>

    <main class="stage">
      <div class="zoom-wrap">
        <div class="card" id="card">
          <div class="inner">
            <div class="comp left"><span id="extLbl">EXT</span></div>
            <div class="comp right"><span id="pvLbl">120</span></div>

            <div class="art"><img id="art-img" alt="Illustration"/></div>

            <div class="panel-desc" id="panelDesc">
              <div class="name" id="nameLbl">Nom de la créature</div>
              <div class="desc" id="descLbl">Sa description et son attaque…</div>
              <div class="baseline">
                <div class="illus" id="illusLbl">Illus. Artiste</div>
                <div class="num" id="numLbl">000/000</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // util
    function hexToRgba(hex, alpha=1){
      const h = hex.replace('#','');
      const n = parseInt(h,16);
      return `rgba(${(n>>16)&255}, ${(n>>8)&255}, ${n&255}, ${alpha})`;
    }

    // Raretés
    const RARETES = {
      'Commun':      { bar:'#93BF34', alpha:1,   cornersBlack:false },
      'Peu Commune': { bar:'#F2AE30', alpha:1,   cornersBlack:false },
      'Rare':        { bar:'#F25430', alpha:1,   cornersBlack:false },
      'Epic':        { bar:'#F23030', alpha:.85, cornersBlack:true  },
      'Légendaire':  { bar:'#F26398', alpha:.85, cornersBlack:true  },
      'Exluusif':    { bar:'#04BF8A', alpha:.85, cornersBlack:true  },
    };

    const els = {
      card: document.getElementById('card'),
      panelDesc: document.getElementById('panelDesc'),
      artImg: document.getElementById('art-img'),
      modele: document.getElementById('modele'),
      rarete: document.getElementById('rarete'),
      nom: document.getElementById('nom'),
      pv: document.getElementById('pv'),
      extension: document.getElementById('extension'),
      numero: document.getElementById('numero'),
      illustrateur: document.getElementById('illustrateur'),
      desc: document.getElementById('desc'),
      image: document.getElementById('image'),
      nameLbl: document.getElementById('nameLbl'),
      descLbl: document.getElementById('descLbl'),
      extLbl: document.getElementById('extLbl'),
      pvLbl: document.getElementById('pvLbl'),
      illusLbl: document.getElementById('illusLbl'),
      numLbl: document.getElementById('numLbl'),
      reset: document.getElementById('reset'),
      exportPNG: document.getElementById('exportPNG'),
    };

    function applyRarete(r){
      const conf = RARETES[r];
      els.panelDesc.style.background = hexToRgba(conf.bar, conf.alpha);
      const cornerColor = conf.cornersBlack ? '#0D0D0D' : '#ffffff'; // noir pour 4–6, blanc sinon
      document.documentElement.style.setProperty('--corner-border', cornerColor);
    }
    function applyModele(m){ els.card.classList.toggle('fullart', m === 'fullart'); }
    function syncText(){
      els.nameLbl.textContent = els.nom.value || 'Nom de la créature';
      els.descLbl.textContent = els.desc.value || 'Sa description et son attaque…';
      els.extLbl.textContent  = els.extension.value || 'EXT';
      els.pvLbl.textContent   = (els.pv.value || '').toString();
      els.illusLbl.textContent= 'Illus. ' + (els.illustrateur.value || 'Artiste');
      els.numLbl.textContent  = els.numero.value || '000/000';
    }
    els.image.addEventListener('change', e=>{
      const f = e.target.files && e.target.files[0];
      if(!f) return;
      els.artImg.src = URL.createObjectURL(f);
    });

    els.modele.addEventListener('change', ()=>applyModele(els.modele.value));
    els.rarete.addEventListener('change', ()=>applyRarete(els.rarete.value));
    ['nom','desc','extension','pv','illustrateur','numero'].forEach(id=>{
      els[id].addEventListener('input', syncText);
    });

    els.reset.addEventListener('click', ()=>{
      els.modele.value='classique';
      els.rarete.value='Commun';
      ['nom','pv','extension','numero','illustrateur','desc'].forEach(id=>els[id].value='');
      els.artImg.src='';
      applyModele('classique');
      applyRarete('Commun');
      syncText();
    });

    // Export PNG
    (function loadHtml2Canvas(){
      const s = document.createElement('script');
      s.src='https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
      s.onload=()=>{
        els.exportPNG.addEventListener('click', async ()=>{
          const node=document.getElementById('card');
          const canvas=await html2canvas(node,{backgroundColor:null,scale:4,useCORS:true});
          const a=document.createElement('a');
          a.href=canvas.toDataURL('image/png'); a.download=(els.nom.value||'carte')+'.png'; a.click();
        });
      };
      s.onerror=()=>{ els.exportPNG.disabled=true; els.exportPNG.textContent='Exporter en PNG (librairie indisponible)'; };
      document.body.appendChild(s);
    })();

    // init
    applyModele('classique');
    applyRarete('Commun');
    syncText();
  </script>
</body>
</html>
