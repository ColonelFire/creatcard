<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Card Generator</title>
<style>
  :root{
    --bg1:#0e1020; --bg2:#0a0c16;
    --panel:#171a30; --line:#111631; --txt:#0f1430; --white:#ffffff;
    --ui:#eef1ff; --muted:#aab3d1;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ui);
           font-family:system-ui,Segoe UI,Arial,Verdana,sans-serif}
  .wrap{display:grid;grid-template-columns:360px 1fr;gap:20px;max-width:1200px;margin:24px auto;padding:0 16px}
  .card{background:var(--panel);border:1px solid #23274b;border-radius:14px;padding:16px}
  h1{font-size:20px;margin:0 0 8px}
  .muted{color:var(--muted);font-size:12px;margin:0 0 14px}
  label{font-weight:700;font-size:12px;display:block;margin:10px 0 6px}
  input[type=text],input[type=number],select,textarea{
    width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f57;background:#0f1230;color:#fff;
  }
  textarea{min-height:110px;resize:vertical}
  input[type=file]{width:100%}
  .row{display:flex;gap:10px}
  .row>*{flex:1}
  .btn{
    appearance:none;border:0;border-radius:12px;padding:12px 14px;background:linear-gradient(135deg,#4cc9f0,#4361ee);
    color:#fff;font-weight:800;cursor:pointer;box-shadow:0 6px 18px rgba(67,97,238,.35)
  }
  .btn:active{transform:translateY(1px)}
  canvas{width:min(520px,90vw);height:auto;background:#e8eaf7;border-radius:18px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
  .preview{display:grid;place-items:center}
  footer{max-width:1200px;margin:18px auto 32px;color:#97a0c8;font-size:12px;padding:0 16px}
</style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>G√©n√©rateur de carte</h1>
      <p class="muted">Remplis les champs, l‚Äôaper√ßu se met √† jour en direct. Clique ensuite sur <b>T√©l√©charger</b>.</p>

      <label for="name">Nom de la cr√©ature</label>
      <input id="name" type="text" placeholder="Ex : Noah Mario" value="Noah Mario" />

      <div class="row">
        <div>
          <label for="hp">PV</label>
          <input id="hp" type="number" min="0" max="999" step="1" value="60" />
        </div>
        <div>
          <label for="rarity">Raret√©</label>
          <select id="rarity">
            <option value="commun" selected>Commun</option>
            <option value="peu">Peu Commun</option>
            <option value="rare">Rare</option>
            <option value="epic">√âpique (full-art)</option>
            <option value="legendaire">L√©gendaire (full-art)</option>
            <option value="exclu">Exclusif (full-art)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="set">Extension (coin haut-gauche)</label>
          <input id="set" type="text" placeholder="ex : GEN1" value="GEN1" />
        </div>
        <div>
          <label for="number">Num√©ro (bas-droite)</label>
          <input id="number" type="text" placeholder="ex : 002/120" value="002/120" />
        </div>
      </div>

      <label for="desc">Texte / attaques</label>
      <textarea id="desc" placeholder="D√©cris les capacit√©s, attaques, effets‚Ä¶">Casquette
‚Äî Ajoute +2 si tu portes une casquette.</textarea>

      <div class="row">
        <div>
          <label for="artist">Illustrateur (bas-gauche)</label>
          <input id="artist" type="text" placeholder="ex : Thernriel" value="Thernriel" />
        </div>
        <div>
          <label for="tone">Couleur panneau bas (si besoin)</label>
          <input id="tone" type="color" value="#8bd62a" />
        </div>
      </div>

      <label for="illus">Illustration (PNG/JPG)</label>
      <input id="illus" type="file" accept="image/*" />

      <div style="display:flex;gap:10px;margin-top:14px">
        <button id="downloadBtn" class="btn">üì• T√©l√©charger en PNG</button>
        <button id="clearImg" class="btn" style="background:linear-gradient(135deg,#ee6055,#ff9b85)">üóëÔ∏è Retirer l‚Äôillustration</button>
      </div>
    </section>

    <section class="preview">
      <canvas id="card" width="900" height="1250" aria-label="Aper√ßu carte"></canvas>
    </section>
  </div>

  <footer>Prototype canvas c√¥t√© client. Aucune donn√©e envoy√©e sur un serveur.</footer>

<script>
(() => {
  // -------- DOM
  const $ = id => document.getElementById(id);
  const cvs = $('card'), ctx = cvs.getContext('2d');
  const f = {
    name: $('name'), hp: $('hp'), rarity: $('rarity'),
    set: $('set'), number: $('number'), desc: $('desc'),
    artist: $('artist'), tone: $('tone'),
    illus: $('illus'), dl: $('downloadBtn'), clear: $('clearImg')
  };

  // -------- Rarity palette & rules
  // Colors picked to roughly match your chips (you can nudge them).
  const RARITY = {
    commun     : {frame:'#343946', band:'#8bd62a', full:false},
    peu        : {frame:'#343946', band:'#ffc447', full:false},
    rare       : {frame:'#000000', band:'#ff6a3d', full:false},
    epic       : {full:true, band:'#ff3b30'},
    legendaire : {full:true, band:'#ff73a9'},
    exclu      : {full:true, band:'#00d19a'}
  };

  // -------- Illustration
  let illusImg = null;

  // -------- Draw helpers
  function rr(x,y,w,h,r, fill, color){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  if (fill) { 
    ctx.fillStyle = color; 
    ctx.fill(); 
  } else {
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.stroke();
  }
}
  function text(x,y,str,size,color,align='left',base='alphabetic'){
    ctx.fillStyle=color; ctx.font=`${size}px system-ui,Segoe UI,Arial`; ctx.textAlign=align; ctx.textBaseline=base;
    ctx.fillText(str,x,y);
  }
  function drawImageCover(img, x,y,w,h){
    const r=Math.max(w/img.width,h/img.height);
    const nw=img.width*r, nh=img.height*r, nx=x+(w-nw)/2, ny=y+(h-nh)/2;
    ctx.drawImage(img,nx,ny,nw,nh);
  }
  function wrapText(str,x,y,maxW,lh,color='#111',align='left'){
    ctx.fillStyle=color; ctx.textAlign=align; ctx.textBaseline='alphabetic';
    const words=str.replace(/\r/g,'').split('\n');
    let yy=y;
    for(const block of words){
      const parts=block.split(' ');
      let line='';
      for(const w of parts){
        const test=line? line+' '+w : w;
        if(ctx.measureText(test).width>maxW){
          ctx.fillText(line,x,yy); yy+=lh; line=w;
        }else line=test;
      }
      ctx.fillText(line,x,yy); yy+=lh;
    }
  }
  // quarter-octagon corner tag (tl or tr)
  function cornerTag(corner, label){
    const W=cvs.width, H=cvs.height, m=46, w=116, h=64, cut=18;
    ctx.save();
    ctx.fillStyle='rgba(255,255,255,.95)'; ctx.strokeStyle='#111631'; ctx.lineWidth=2;
    ctx.beginPath();
    if(corner==='tl'){
      ctx.moveTo(m,h+m-cut); ctx.lineTo(m,m+cut);
      ctx.lineTo(m+cut,m); ctx.lineTo(m+w-cut,m); ctx.lineTo(m+w,m+cut);
      ctx.lineTo(m+w,m+h-cut); ctx.lineTo(m+w-cut,m+h);
      ctx.lineTo(m+cut,m+h); ctx.closePath();
    }else{ // tr
      const x=W-m-w;
      ctx.moveTo(x,m+cut); ctx.lineTo(x+cut,m);
      ctx.lineTo(x+w-cut,m); ctx.lineTo(x+w,m+cut);
      ctx.lineTo(x+w,m+h-cut); ctx.lineTo(x+w-cut,m+h);
      ctx.lineTo(x+cut,m+h); ctx.lineTo(x,m+h-cut); ctx.closePath();
    }
    ctx.fill(); ctx.stroke();
    const tx = corner==='tl' ? (m+w/2) : (W-m-w/2);
    text(tx, m+h/2, label, 24, '#111631','center','middle');
    ctx.restore();
  }

  // -------- Main draw
  function draw(){
    const W=cvs.width, H=cvs.height, m=28;
    const rar = RARITY[f.rarity.value];
    const band = f.tone.value || rar.band;
    const full = !!rar.full;

    // background
    const g=ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#f7f8ff'); g.addColorStop(1,'#ebeeff');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

   if (full){
  if(illusImg) drawImageCover(illusImg, m, m, W-2*m, H-2*m);
  const ph = Math.floor(H*0.34);
  ctx.fillStyle = hexToRGBA(band, 0.78);
  rr(m+20, H-ph-20, W-2*(m+20), ph, 18, true, ctx.fillStyle);
  text(W/2, H-ph-20+36, (f.name.value||'Sans nom'), 44, '#ffffff','center','alphabetic');
  ctx.font='18px system-ui,Segoe UI,Arial';
  wrapText(f.desc.value, m+40, H-ph-20+72, W-2*(m+40), 28, '#ffffff','left');
}

    }else{
      // CADRE : bord + grande zone illustration en haut, bandeau color√© en bas
      // cadre ext√©rieur anthracite
      rr(m,m,W-2*m,H-2*m,26,true,'#111631');
      // cadre int√©rieur selon raret√©
      rr(m+8,m+8,W-2*(m+8),H-2*(m+8),22,true, rar.frame);
      // fen√™tres
      const topH = Math.floor((H-2*(m+16))*0.60);  // ~3/5 en haut
      // illustration
      rr(m+16,m+16,W-2*(m+16),topH,16,true,'#ffffff');
      if(illusImg) drawImageCover(illusImg, m+16, m+16, W-2*(m+16), topH);
      // s√©paration fine au 2/5 du bas (donc limite zone texte)
      ctx.fillStyle = rar.frame; ctx.fillRect(m+12, m+16+topH+6, W-2*(m+12), 4);

      // zone bas teint√©e par la couleur de la raret√© (l√©g√®re)
      const bottomY = m+16+topH+16;
      const bottomH = H - bottomY - (m+16);
      ctx.fillStyle = hexToRGBA(band, 0.15);
      rr(m+16, bottomY, W-2*(m+16), bottomH, 16, true, ctx.fillStyle);
      rr(m+22, bottomY+6, W-2*(m+22), bottomH-12, 12, true, '#ffffff');

      // nom centr√© en haut de la partie basse
      text(W/2, bottomY+36, (f.name.value||'Sans nom'), 42, '#111631','center','alphabetic');
      ctx.font='18px system-ui,Segoe UI,Arial';
      wrapText(f.desc.value, m+32, bottomY+72, W-2*(m+32), 28, '#111631','left');
    }

    // coins : extension (gauche) & PV (droite)
    cornerTag('tl', (f.set.value||''));
    cornerTag('tr', (String(f.hp.value||'') ));

    // cr√©dits bas
    text(m+24, H-m-18, 'Art : ' + (f.artist.value||'-'), 16, '#111631','left','alphabetic');
    text(W-m-24, H-m-18, (f.number.value||''), 16, '#111631','right','alphabetic');
  }

  // -------- small utils
  function hexToRGBA(hex, a=1){
    const h=hex.replace('#','');
    const n=parseInt(h.length===3 ? h.split('').map(c=>c+c).join('') : h,16);
    const r=(n>>16)&255, g=(n>>8)&255, b=n&255;
    return `rgba(${r},${g},${b},${a})`;
  }

  // -------- events
  ['name','hp','rarity','set','number','desc','artist','tone'].forEach(id=>{
    $(id).addEventListener('input', draw);
  });

  f.illus.addEventListener('change', async (e)=>{
    const file = e.target.files?.[0];
    if(!file){ illusImg=null; draw(); return; }
    const dataUrl = await new Promise((res,rej)=>{const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file);});
    illusImg = await new Promise((res,rej)=>{const im=new Image(); im.onload=()=>res(im); im.onerror=rej; im.src=dataUrl;});
    draw();
  });
  f.clear.addEventListener('click', ()=>{ f.illus.value=''; illusImg=null; draw(); });
  f.dl.addEventListener('click', ()=>{
    const a=document.createElement('a');
    a.download = `${(f.name.value||'carte')}.png`;
    a.href = cvs.toDataURL('image/png');
    a.click();
  });

  // first render
  draw();
})();
</script>
</body>
</html>
